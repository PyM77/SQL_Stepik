#programming #database #SQL 

### Соединение INNER JOIN

Оператор внутреннего соединения `INNER JOIN` соединяет две таблицы. 

```SQL
SELECT 
...
FROM
	таблица_1 INNER JOIN таблица_2
	ON условие
...

```

Результат запроса создается след. образом:

- Каждая строка одной таблицы сравнивается с строкой другой таблицы
- Для получения объединенной строки проверяется условие соедминения указанное через `ON`
- Если условие проходит, то добавляется эта объеденненая строка

*Пример*

Вывести название книг и их авторов:

```SQL
SELECT title, name_author
FROM
	author INNER JOIN book
	ON author.author_id = book.author_id
```


### Внешнее соединение LEFT и RIGHT OUTER JOIN

Операторы соединения `LEFT JOIN` и `RIGHT JOIN` тоже соединяют две таблицы. Только они при наличии значения у указанной стороный все равно соединяют две строки, к примеру если указать `LEFT JOIN` то в таблице будут так же значение у которых было только левое значение, а правое будет равняться `NULL`. От сюда следует что и указания  порядка соединения таблиц важен, не то что в `INNER JOIN`.

```SQL
SELECT
...
FROM
	таблица_1 LEFT JOIN таблица_2
	ON условие
...
```

Результат запроса формируется так:

1. В результате будет внутренее соединение `INNER JOIN` первой и второй таблицы
2. Далее добавляются результаты из таблицы с лева которые были пропузены при первом шаге, а поле находящее справо для них будет равна `NULL`

Функция `RIGHT JOIN` действует анллогично

Пример кода:

```SQL
SELECT name_author, title
FROM author LEFT JOIN book 
	ON author.author_id = book.author_id
ORDER BY name_author;
```


### Перекрестное соединение CROSS JOIN

Оператор перекрестного соединения `CROSS JOIN`, этот оператор соединяет одно значение со всеми значениями из второй таблицы, можно сказать что каждая строка из первой таблицы проходиться по всем таблицам из второй таблицы. Его структура выглядит так:

```SQL
SELECT 
...
FROM
	таблица_1 CROSS JOIN таблица_2
...
```

_Примечание_: *Можно указать две таблицы через запятую*

Пример запроса:

```SQL
SELECT name_author, name_genre
FROM 
	author, genre;
```


### Запросы на выборку из нескольких таблиц

В запросах на выборку можно выбрать два или более таблиц, делается это через `INNER JOIN` , так же необходимо чтобы таблицы были связаны между собой, представим что таблицы связаны следующим образом:

	![[Pasted image 20230429223544.jpg]]

тогда запрос на выборку этих данных будет иметь следующий вид:

```SQL
SELECT
...
FROM 
	first
	INNER JOIN second ON first.first_id = second.first_id
	INNER JOIN third ON second.second_id = third.second_id
...
```

Если же таблицы связаны иначе:

	![[Pasted image 20230429223901.jpg]]

то запрос на выборку выглядит следующим образом:

```SQL
SELECT
...
FROM
	first
	INNER JOIN third ON first.first_id = third.first_id
	INNER JOIN second ON third.second_id = second.second_id
...
```



### Вложенные запросы в операторах 

Вложенные запросы можно так же използьовать в операторах соединения `JOIN`.

```SQL
SELECT
...
FROM
	таблица ... JOIN 
		(
		SELECT ...
		) имя_вложенного_запроса
	ON условие
...
```

Вложенные запрос можно изпользовать как справа, так и слевва от оператора `JOIN` а так же можно их соединять вместе

### Операция соединения, изпользование USING()

При реализации соединения при помощи `JOIN` вместо условия `ON` можно изпользовать `USING` 

`USING` позволяет указать набор столбцов, которые есть в обеих таблицах. Если БД хорошо спроектирована и внешний ключ имеет такой соотношение как первичный (например `genre.genre_id = book.genre_id`), тогда можно изпользовать `USING` 

```SQL
SELECT title, name_author, author_id
FROM 
	author INNER JOIN book
	USING(author_id);
```

