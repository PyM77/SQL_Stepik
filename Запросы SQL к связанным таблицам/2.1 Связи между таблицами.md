#SQL #database #programming 

### Связь "Один ко многим"
	
Связь один ко многим имеет место быть в тех случаях, когда одно  значение относится ко многим значениям в таблице, и для удобства изпользования ее можно вынести в отедльную таблицу 

*Этапы реализации связи:*

1. Создаем таблицу автор в которую включаем уникальные имена авторов храняшиеся на складе:

	![[Pasted image 20230423150444.jpg]]

2. Обе таблицы должны содержать первичный ключ, в таблице `book` он уже есть, добавим к таблице `author`, ячейку `author_id:

	![[Pasted image 20230423150816.jpg]]

3. Включить в таблицу `book` связанный столбец(внешний ключ `FOREIGHN KEY`)  соответсвующее по имени и ключевому слову таблице `author`, (в нашем случае это столбец `author_id`):

	![[Pasted image 20230423151221.jpg]]



### Связь "Многие ко многим"

Связь "Многие ко многим" имеет место быть в том случае, если несколько записей одной таблицы соотвествуют ко второй, и так же наоборот записи второй соотвествуют записи первой

По этапная реализация связи "многие ко многим":

Один автор может написать несколько книг, а одна книга может быть написана несколькими авторами. Для каждой книги известны ее количество и цена

1. Создать таблицу `author`, в которую можно включить уникальных авторов книг 

	![[Pasted image 20230424234645.jpg]]

2. В обеих таблицах необходимо определить первичный ключ, в таблице `book` уже есть  `book_id`, нужно включить первичный ключ для `author`,  `author_id`
	
	![[Pasted image 20230424234922.jpg]]

3. Создаем новую таблицу связку для этих двух таблиц, столбцы которой соотвествуют, столбцам `author_id` и `book_id` 

	![[Pasted image 20230424235307.jpg]]

4. Необходимо определиться первичным ключом для таблицы связки. Для нужно в связывающую таблицу добавить перчиный ключ `book_author_id`:

	![[Pasted image 20230424235725.jpg]]


### Создание таблицы с внешними включами

При создание внешней таблицы необходимо учитывать следующее:

- Каждый внешний ключ должен иметь такой же тип, как в той таблице где находиться столбец
- Так же необходимо указать для нее таблицу и столбец, по которому осуществляется связь:

```SQL
FOREIGN KEY (связанное_поле_зависимой_таблицы)
REFERENGES главная таблица (связанное_поле_главное_таблицы)
```

По умолчанию любой столбец, кроме ключевого может содержать значение `NULL`.
При создании таблицы это можно переопределить 

```SQL
CREATE TABLE book(
	столбец_1 INT NOT NULL,
	столбец_2 VARCHAR(10)
);
```

В этой таблице `столбец_1` не может содержать пустой значение, а `столбец_2` может

*Пример кода  написанного при решении задач:*

```SQL
CREATE TABLE book(
	book_id INT PRIMARY KEY AUTO_INCREMENT,
	title VARCHAR(50),
	author_id INT NOT NULL,
	genre_id INT,
	price DECIMAL(8, 2),
	amount INT,
	FOREIGN KEY (author_id) REFERENGES author (author_id),
	FOREIGN KEY (genre_id) REFERENGES genre (genre_id)
);
```


### Действия при удалении записи главной таблицы

С помощью `ON DELETE` можно выполнить действия выполняемые при удалении связанной строки из главной таблицы. При удалении можно установить след. опции:

- `CASCADE`: при удалении связаных строк из основной таблицы, автоматически удаляет и с зависимой.
- `SET NULL`: при удалении связаной строки из основной таблицы, в зависимой автоматически заменяется нa `NULL` . (В этом случае столбец внешнего включа должно поддерживать установку `NULL`)
- `SET DEFAULT`: похоже на `SET NUL`, за исключением того что внешний ключ вместо `NULL` будет содержать значение по умолчанию для него.
- `RESTRICT`: отклоняет удаление строк в главной таблице при наличии связанных строк в зависимой таблицы


